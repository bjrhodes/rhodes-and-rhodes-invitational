---
import BaseLayout from '@components/base/BaseLayout.astro';
import PageHeader from '@/components/common/PageHeader.astro';
// import { markdownify } from '@lib/textConverter';

const title = 'Results to date';
const description = 'This will be updated as we go!';

const AshtonCourt = {
  name: 'Ashton Court',
  par: [4, 4, 3, 3, 4, 3, 3, 4, 3, 3, 3, 3, 3, 3, 4, 3, 3, 3],
  scores: {
    Barry: [10, 4, 4, 3, 7, 3, 6, 6, 3, 4, 4, 6, 5, 4, 5, 4, 5, 4],
    Louise: [8, 8, 5, 3, 7, 5, 5, 7, 6, 5, 5, 6, 5, 6, 6, 5, 5, 5],
    Will: [6, 9, 5, 3, 6, 3, 5, 5, 5, 4, 7, 5, 4, 5, 8, 5, 6, 4],
    Tara: [8, 7, 5, 3, 5, 4, 4, 8, 5, 6, 4, 7, 5, 4, 6, 4, 5, 5],
    Adam: [6, 5, 4, 3, 5, 4, 4, 5, 5, 4, 7, 7, 7, 5, 3, 5, 5, 4],
    Rob: [7, 7, 4, 3, 5, 4, 5, 6, 5, 4, 4, 5, 7, 5, 5, 5, 4, 5],
    Fin: [8, 12, 8, 3, 6, 4, 8, 8, 5, 5, 4, 5, 5, 5, 6, 5, 6, 4],
    Aiden: null,
  },
};

const Mendips = {
  name: 'Mendips Activity Centre',
  par: [3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 3, 3, 3, 3, 4, 4, 3, 3],
  scores: {
    Rob: [5, 4, 6, 5, 5, 5, 5, 4, 4, 9, 4, 6, 5, 6, 7, 6, 5, 4],
    Barry: [6, 4, 4, 5, 4, 5, 5, 4, 4, 8, 5, 6, 8, 5, 7, 6, 5, 4],
    Will: [5, 4, 5, 6, 6, 6, 4, 4, 5, 7, 7, 5, 6, 5, 9, 6, 5, 5],
    Tara: [8, 5, 5, 5, 5, 6, 5, 6, 4, 8, 5, 5, 5, 5, 8, 8, 6, 5],
    Adam: [5, 4, 7, 9, 5, 6, 6, 4, 3, 8, 6, 5, 5, 6, 8, 6, 5, 6],
    Aiden: [6, 5, 6, 5, 4, 5, 4, 6, 6, 11, 6, 6, 6, 7, 7, 7, 6, 5],
    Louise: null,
    Fin: null,
  },
};

const Edgcumbe = {
  name: 'Mount Edgcumbe',
  par: [3, 4, 3, 4, 3, 3, 4, 4, 4, 4, 3, 3, 4, 3, 3, 3, 3, 5],
  scores: {
    Rob: [4, 5, 5, 6, 4, 3, 7, 6, 5, 6, 3, 5, 8, 5, 5, 4, 3, 6],
    Barry: [3, 4, 5, 8, 3, 4, 5, 6, 6, 5, 4, 5, 6, 4, 4, 4, 3, 5],
    Will: [3, 6, 4, 7, 3, 4, 7, 7, 6, 6, 3, 5, 9, 5, 5, 5, 2, 7],
    Tara: [4, 6, 4, 5, 4, 4, 5, 7, 6, 9, 5, 4, 7, 5, 6, 6, 2, 7],
    Adam: [3, 4, 3, 9, 4, 3, 5, 7, 7, 5, 4, 5, 7, 4, 4, 6, 3, 7],
    Aiden: null,
    Louise: null,
    Fin: [5, 6, 7, 6, 4, 6, 7, 7, 10, 6, 3, 5, 9, 6, 6, 4, 3, 9],
  },
};

const Basset = {
  name: 'Basset down',
  par: [3, 3, 3, 3, 3, 4, 3, 3, 3, 3, 4, 3, 3, 3, 3, 3, 3, 3],
  scores: {
    Rob: null,
    Barry: [3, 3, 3, 3, 3, 4, 3, 3, 3, 3, 4, 3, 3, 3, 3, 3, 3, 3],
    Will: null,
    Tara: null,
    Adam: null,
    Aiden: null,
    Louise: null,
    Fin: null,
  },
};

const Cricklade = {
  name: 'Cricklade Hotel',
  par: [3, 3, 5, 4, 4, 3, 3, 3, 4, 4, 4, 3, 3, 3, 4, 3, 3, 4],
  scores: {
    Rob: null,
    Barry: [3, 3, 5, 4, 4, 3, 3, 3, 4, 4, 4, 3, 3, 3, 4, 3, 3, 4],
    Will: null,
    Tara: null,
    Adam: null,
    Aiden: null,
    Louise: null,
    Fin: null,
  },
};

const rounds = [AshtonCourt, Mendips, Edgcumbe, Basset, Cricklade];

const allPlayers = Array.from(
  new Set(
    rounds.reduce<(keyof typeof Mendips.scores)[]>(
      (players, round) =>
        players.concat(
          Object.keys(round.scores) as (keyof typeof Mendips.scores)[]
        ),
      []
    )
  )
);

const sum = (arr: number[] | null) =>
  arr ? arr.reduce((t, n) => t + n, 0) : 0;

const ashtonMax = Object.values(AshtonCourt.scores).reduce(
  (soFar, scores) => Math.max(soFar, sum(scores)),
  0
);
const mendipMax = Object.values(Mendips.scores).reduce(
  (soFar, scores) => Math.max(soFar, sum(scores)),
  0
);
const edgcumbeMax = Object.values(Edgcumbe.scores).reduce(
  (soFar, scores) => Math.max(soFar, sum(scores)),
  0
);
const bassetMax = Object.values(Basset.scores).reduce(
  (soFar, scores) => Math.max(soFar, sum(scores)),
  0
);
const crickladeMax = Object.values(Cricklade.scores).reduce(
  (soFar, scores) => Math.max(soFar, sum(scores)),
  0
);

const allScores = allPlayers.map((name) => {
  const ashton = {
    total:
      AshtonCourt.scores[name] === null
        ? ashtonMax
        : sum(AshtonCourt.scores[name]),
    score: AshtonCourt.scores[name] ?? null,
  };
  const mendip = {
    total:
      Mendips.scores[name] === null ? mendipMax : sum(Mendips.scores[name]),
    score: Mendips.scores[name] ?? null,
  };
  const edgcumbe = {
    total:
      Edgcumbe.scores[name] === null ? edgcumbeMax : sum(Edgcumbe.scores[name]),
    score: Edgcumbe.scores[name] ?? null,
  };
  const basset = {
    total: Basset.scores[name] === null ? bassetMax : sum(Basset.scores[name]),
    score: Basset.scores[name] ?? null,
  };
  const cricklade = {
    total:
      Cricklade.scores[name] === null
        ? crickladeMax
        : sum(Cricklade.scores[name]),
    score: Cricklade.scores[name] ?? null,
  };

  return {
    name,
    ashton,
    mendip,
    edgcumbe,
    basset,
    cricklade,
    grand: mendip.total + ashton.total + edgcumbe.total,
  };
});

allScores.sort(({ grand: a }, { grand: b }) => (a === b ? 0 : a > b ? 1 : -1));

const overUnder = (score: number, pars: number[]) => {
  const delta = score - sum(pars);
  return delta > 0 ? `+${delta}` : `-${Math.abs(delta)}`;
};
---

<BaseLayout title={'title'} description={description}>
  <PageHeader title={title} />
  <div class="container">
    <div style="display: grid; gap: 24px; grid-template-columns: 1fr 1fr;">
      {
        allScores.map((player) => (
          <div class="glass rounded-lg p-4 mb-4 intersect:animate-fadeUp opacity-0">
            <nav class="relative flex flex-wrap items-center justify-between">
              <h4>{player.name}</h4>
              <p class="mb-4 ">
                <strong>Tournament score: {player.grand}</strong>
              </p>
            </nav>
            <h5>Rounds</h5>
            <p class="mb-4">
              Ashton court: {player.ashton.total}
              <span>({overUnder(player.ashton.total, AshtonCourt.par)})</span>
              {player.ashton.score === null ? '(no-show default)' : ''}
            </p>
            <p class="mb-4">
              Mendips: {player.mendip.total}
              <span>({overUnder(player.mendip.total, Mendips.par)})</span>
              {player.mendip.score === null ? '(no-show default)' : ''}
            </p>
            <p class="mb-4">
              Mount Edgcumbe: {player.edgcumbe.total}
              <span>({overUnder(player.edgcumbe.total, Edgcumbe.par)})</span>
              {player.edgcumbe.score === null ? '(no-show default)' : ''}
            </p>
            <p class="mb-4">
              Basset Down: {player.basset.total}
              <span>({overUnder(player.basset.total, Basset.par)})</span>
              {player.basset.score === null ? '(no-show default)' : ''}
            </p>
            <p class="mb-4">
              Cricklade Hotel: {player.cricklade.total}
              <span>({overUnder(player.cricklade.total, Cricklade.par)})</span>
              {player.cricklade.score === null ? '(no-show default)' : ''}
            </p>
          </div>
        ))
      }
    </div>
    <div class="glass rounded-lg p-4 mb-4 intersect:animate-fadeUp opacity-0">
      <h4>Positions Table</h4>
      <table style="width: 100%">
        <thead>
          <tr>
            <th>Player</th>
            <th>Ashton court:</th>
            <th>Mendips:</th>
            <th>Mount Edgcumbe:</th>
            <th>Basset Down:</th>
            <th>Cricklade Hotel:</th>
            <th>Overall</th>
          </tr>
        </thead>
        <tbody>
          <tr style="text-align: center;">
            <td style="text-align: left">Barry</td>
            <td>1st (87)</td>
            <td>1st (95)</td>
            <td>1st (84)</td>
            <td></td>
            <td></td>
            <td style="text-align: right; font-weight: bold;">1st (266)</td>
          </tr>
          <tr style="text-align: center;">
            <td style="text-align: left">Rob</td>
            <td>3rd (90)</td>
            <td>1st (95)</td>
            <td>2nd (90)</td>
            <td></td>
            <td></td>
            <td style="text-align: right; font-weight: bold;">2nd (275)</td>
          </tr>
          <tr style="text-align: center;">
            <td style="text-align: left">Adam</td>
            <td>2nd (88)</td>
            <td>4th (104)</td>
            <td>2nd (90)</td>
            <td></td>
            <td></td>
            <td style="text-align: right; font-weight: bold;">3rd (282)</td>
          </tr>
          <tr style="text-align: center;">
            <td style="text-align: left">Will</td>
            <td>4th (95)</td>
            <td>3rd (100)</td>
            <td>4th (954</td>
            <td></td>
            <td></td>
            <td style="text-align: right; font-weight: bold;">4th (289)</td>
          </tr>
          <tr style="text-align: center;">
            <td style="text-align: left">Tara</td>
            <td>4th (95)</td>
            <td>4th (104)</td>
            <td>5th (96)</td>
            <td></td>
            <td></td>
            <td style="text-align: right; font-weight: bold;">5th (295)</td>
          </tr>
          <tr style="text-align: center;">
            <td style="text-align: left">Louise</td>
            <td>6th (102)</td>
            <td>n/a</td>
            <td>n/a</td>
            <td></td>
            <td></td>
            <td style="text-align: right; font-weight: bold;">6th (319)</td>
          </tr>
          <tr style="text-align: center;">
            <td style="text-align: left">Fin</td>
            <td>7th (107)</td>
            <td>n/a</td>
            <td>6th (109)</td>
            <td>n/a</td>
            <td>n/a</td>
            <td style="text-align: right; font-weight: bold;">7th (324)</td>
          </tr>
          <tr style="text-align: center;">
            <td style="text-align: left">Aiden</td>
            <td>n/a</td>
            <td>6th (108)</td>
            <td>n/a</td>
            <td>n/a</td>
            <td>n/a</td>
            <td style="text-align: right; font-weight: bold;">7th (324)</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</BaseLayout>
